### 설치
1. pubspec.yaml 파일의 `dependencies`하위에 Flutter SDK에 대한 의존성 추가
```dart
dependencies: 
	kakao_flutter_sdk: ^1.8.0 // 전체 추가 
	kakao_flutter_sdk_user: ^1.8.0 // 카카오 로그인 
	kakao_flutter_sdk_talk: ^1.8.0 // 카카오톡 메시지, 카카오톡 소셜(프로필 가져오기, 친구 목록 가져오기) 
	kakao_flutter_sdk_share: ^1.8.0 // 카카오톡 공유 
	kakao_flutter_sdk_navi: ^1.8.0 // 카카오내비 
	kakao_flutter_sdk_friend: ^1.8.0 // 카카오톡 소셜(피커: 친구 선택하기)
```
- 또는 명령어를 통해 전체 패키지를 추가할 수도 있음
```dart
$ flutter pub add kakao_flutter_sdk
```
<br>

2. Flutter SDK 설치
```dart
$flutter pub get
```
<br>

### Kakao Developers 홈페이지 설정
홈페이지 로그인 한 후 "내 애플리케이션"으로 이동
#### 프로젝트 추가

"애플리케이션 추가하기" 클릭 -> 아이콘, 앱이름, 사업자명, 카테고리 하고 싶은대로 설정
![](images/Pasted%20image%2020240215162001.png)
![](images/Pasted%20image%2020240215160940.png)

프로젝트 선택
![](images/Pasted%20image%2020240215161336.png)
<br>
#### 플랫폼 설정
만든 프로젝트에 들어가서 **플랫폼 설정하기** 클릭
![](images/Pasted%20image%2020240215161248.png)
<br>

**Android 플랫폼 등록**, **iOS 플랫폼 등록**을 클릭해서 각각 플랫폼 등록
![](images/Pasted%20image%2020240215161506.png)<br>


##### Android 플랫폼 설정하기

**Android 플랫폼 등록** 클릭 -> **패키지명**, **마켓 URL**, **키 해시** 입력
![](images/Pasted%20image%2020240210190828.png)
<br>
##### 패키지명
- `AndroidManifest.xml` 파일의 `package=`어트리뷰트 참조
- 만약 없으면 android -> app -> build.gradle에 있는 `android {}`안의 `defaultConfig{}`의 `applicationId`속성에 적힌 값을 보면 됨
##### 마켓 URL
- 패키지명을 입력하고 구글 플레이를 선택하면(플레이스토어에 올릴 경우) 자동으로 URL이 생성됨
##### 키 해시
- 키 해시(Key Hash)란 [인증서(Certificate)](https://developer.android.com/studio/publish/app-signing#certificates)의 인증서 지문 값(Certificate fingerprints)을 해시(hash)한 값
- 악성 앱인지 판별하는 데 사용
- 카카오 API를 호출하면 카카오 API 서버가 요청 헤더에 추가된 키 해시값과 카카오 플랫폼에 등록한 값이 일치하는지 확인
- 키 해시는 디버그 키 해시(Debug key hash)와 릴리즈 키 해시(Release key hash) 두 가지
    - 디버그 키 해시: 프로젝트를 처음 생성하거나 디버그할 때, 안드로이드 스튜디오에서 개발 환경에 맞게 자동으로 생성되는 [디버그 인증서](https://developer.android.com/studio/publish/app-signing#debug-mode)에서 해시(hash)한 값
    - 릴리즈 키 해시: 앱 스토어에 앱을 배포하기 위해 생성한 릴리즈 인증서로부터 해시한 값

디버그 키 해시(Mac)
```jsx
keytool -exportcert -alias androiddebugkey -keystore ~/.android/debug.keystore -storepass android -keypass android | openssl sha1 -binary | openssl base64
```
<br>

 릴리즈 키 해시(Mac)
```jsx
keytool -exportcert -alias <RELEASE_KEY_ALIAS> -keystore <RELEASE_KEY_PATH> | openssl sha1 -binary | openssl base64
```
<br>

- 디버그 키 해시를 발급하였고 터미널에 코드를 입력하면 키 해시 발급
![](images/Pasted%20image%2020240211134721.png)<br>

##### iOS 플랫폼 설정하기


##### 로그인 활성화
`off`되어 있는 '카카오 로그인' `on`으로 클릭해서 활성화
![](images/Pasted%20image%2020240212160652.png)
##### 동의항목
같은 페이지에서 필요한 동의항목 설정
![](images/Pasted%20image%2020240212160845.png)
### 프로젝트 설정

#### 커스텀 URL 스킴
##### Android
android -> app -> src의 **`AndroidManifest.xml`** 파일 수정
```xml
<!-- 카카오 로그인 커스텀 URL 스킴 설정 --> 
<activity 
	android:name="com.kakao.sdk.flutter.AuthCodeCustomTabsActivity"
	android:exported="true"> 
	<intent-filter android:label="flutter_web_auth"> 
		<action android:name="android.intent.action.VIEW" /> 
		<category android:name="android.intent.category.DEFAULT" /> 
		<category android:name="android.intent.category.BROWSABLE" />
		
		<!-- "kakao${YOUR_NATIVE_APP_KEY}://oauth" 형식의 앱 실행 스킴 설정 -->
		 <!-- 카카오 로그인 Redirect URI --> 
		 <data 
		 android:scheme="kakao${YOUR_NATIVE_APP_KEY}"
		 android:host="oauth"/> 
	</intent-filter> 
</activity>
```
- `${YOUR_NATIVE_APP_KEY}`대신 네이티브 앱 키 입력
![](images/Pasted%20image%2020240211154917.png)<br>

#### SdkVersion 변경
##### build.gradle
- android -> app -> build.gradle에서 minSdkVersion을 19 이상으로 조정
- 같은 곳에서 compileSdkVersion을 33 이상으로 조정
![](images/Pasted%20image%2020240212135931.png)
![](images/Pasted%20image%2020240212140042.png)

### 로그인 구현
##### social_login.dart
다른 로그인도 쓸 수 있게 로그인, 로그아웃 기능을 관리하는 abstract class 생성
```dart
abstract class SocialLogin() {
	Future<bool> login();
	Future<bool> logout();
}
```
##### kakao_login.dart
카카오의 `login()`, `logout()` 구현
```dart
import 'pakage:kakao_flutter_sdk/kakao_flutter_sdk_talk.dart';

//lib/login 폴더 만들어서 안에 저장한 social_login.dart의 SocialLogin 호출
import 'package:near_ring/login/social_login.dart';

class KakaoLogin implements SocialLogin {
	@override
	Future<bool> login() async {
		try {
			//카카오톡이 폰에 있는지 확인
			bool isInstalled = await isKakaoTalkInstalled();
			//깔려 있는 경우
			if (isInstalled) {
				try {
					//카카오톡 로그인 실행
					await UserApi.instance.loginWithKakaoTalk();
					//성공하면 true
					return true;
				} catch (error) {
					//error 발견하면 false
					return false;
				}
			}
		} else {
			//카카오톡 안 깔려 있으면
			try {
				//웹으로 카카오톡 계정 로그인 실행
				await UserApi.instance.loginWithKakaoAccount();
				//성공하면 true
				return true;
			} catch (error) {
				//error 발견하면 false
				return false;
			}
		} catch (error) {
			//그 외 error로 실행 안될 시 false 반환
			return false;
		}
	}

	@override
	Future<bool> logout() async {
		try {
			//로그아웃 실행
			await UserApi.instance.unlink();
			//성공시 true
			return true;
		} catch (error) {
			//error 발견시 false
			return false;
		}
	}
}
```
##### main_view_model.dart
로그인 후 사용자 정보 가져오는 파일
```dart
import 'package:kakao_flutter_sdk/kakao_flutter_sdk_talk.dart';
import 'package:near_ring/login/social_login.dart';

class MainViewModel {
	final SocialLogin _socialLogin;
	bool isLogined = false; //처음엔 로그인 안 된 상태
	User? user; //카카오톡에서 사용자 정보를 저장하는 객체 User를 nullable 변수로 선언

	MainViewModel(this._socialLogin);

	Future login() async {
		isLogined = await _socialLogin.login(); //로그인되어 있는지 확인
		user = await UserApi.instance.me(); //사용자 정보 받아오기
	}

	Future logout() async {
		await _socialLogin.logout(); //로그아웃 실행
		isLogined = false; //로그인되어 있는지를 저장하는 변수 fasle값 저장
		user = null; //user 객체 null
	}
}
```
##### auth.dart
로그인 버튼을 화면에 구현하고, 버튼을 눌렀을 때 함수를 정의할 페이지
```dart
class AuthScreen extends StatefulWidget {
	const AuthScreen({super.key});

	@override
	State<AuthScreen> createState() => _AuthScreenState();
}

class _AuthScreenState extends State<AuthScreen> {
	final viewModel = MainViewModel(KakaoLogin());

	//로그인 버튼에 연결된 함수
	void kakaoLogin() async {
		await viewModel.login();
		setState(() {});
	}

	//로그아웃 버튼에 연결된 함수
	void kakaoLogout() async {
		await viewModel.logout();
		setState(() {});
	}
}
```