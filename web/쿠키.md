## 쿠키란?

>서버가 어떤 데이터를 브라우저 측에 저장한 후 다시 그 데이터를 받아오는 기술, 또는 그 데이터 그 자체

- [O] 따라서 브라우저의 역할이 중요!

- 브라우저와 서버는 HTTP 프로토콜 상에서 구현, 쿠키는 HTTP 메시지의 헤더(header) 영역을 통해서 송수신 되도록 약속
------------------
## 쿠키의 메커니즘
#### 형태 

><이름>=<값>

- HTTP 메시지 안에 이 쿠키를 담아서 주고 받음

*클라이언트 서버 모델에서 서버가 클라이언트의 요청없이 클라이언트로 데이터를 보낼 수 없음!*

-> 따라서 쿠키 전달 과정은 클라이언트가 요청에 응답할 때 일어나게 됨

#### Set-Cookie

하나의 `Set-Cookie` 응답 헤더에는 하나의 쿠키만 담을 수 있음

##### 📩 HTTP 응답
```js
Set-Cookie: <이름>=<값>
Set-Cookie: <이름>=<값>
Set-Cookie: <이름>=<값>
```

- 이렇게 서버로부터 쿠키를 응답 받은 브러우저는 우선 해당 쿠키를 클라이언트 컴퓨터의 하드디스크에 저장
- 브라우저가 동일한 서버에 요청을 할 때 저장해놓은 쿠키를 `Cookie`라는 요청 헤더에 실어서 돌려 보냄

##### 🕹️HTTP 요청
```js
Cookie: <이름>=<값>; <이름>=<값>; <이름>=<값>;
```

>서버가 `Set-Cookie`로 보내는 것 = 일회성
>BUT 
>브라우저가 `Cookie` 헤더를 통해 서버로 쿠키를 돌려 보내는 것 = 일정 시간동안 반복


----------------------
## 쿠키의 송수신 예제

`a=1`, `b=2` 라는 2개의 쿠키를 브라우저에 저장하고 싶다!

`www.test.com` 서버는 브라우저의 요청이 들어오면 각 쿠키를 `Set-Cookie` 헤더에 실어서 응답

##### 🕹️HTTP 요청
```js
GET /index.html HTTP/1.1
Host: www.test.com
```

##### 📩 HTTP 응답
```js
HTTP/1.1 200 OK
Content-Type: text/html
Set-Cookie: a=1
Set-Cookie: b=2
```

- 브라우저는 서버로부터 받은 이 2개의 쿠키를 클라이언트의 하드디스크에 저장
- 추후 동일한 서버로 요청을 할 때마다 `Cookie` 헤더에 쿠키를 그대로 돌려 보냄

##### 🕹️HTTP 요청
```js
GET /index.html HTTP/1.1
Host: www.test.com
Cookie: a=1, b=2
```

>해당 브라우저는 사용자가 `www.test.com`이라는 도메인에 머무는 한 `/index.html`을 방문하든 `/about.html`을 방문하든 `/contact.html`을 방문하든 매번 같은 쿠키를 돌려줌

##### 🕹️HTTP 요청
```js
GET /about.html HTTP/1.1
Host: www.test.com
Cookie: a=1, b=2
```

##### 🕹️HTTP 요청
```js
GET /contact.html HTTP/1.1
Host: www.test.com
Cookie: a=1, b=2
```


-----------------
## 쿠키의 유효 기간

>서버가 맨 처음 쿠키를 보낼 때 결정, `Set-Cookie` 응답 헤더를 통해 명시되어야 함

- 유효 기간이 별도로 명시되지 않은 쿠키를 보통 ==세션 쿠키(session cookie)==라고 부르는데 브라우저의 ==*세션이 종료될 때 함께 만료됨*==
- 즉, 브라우저의 ==*탭이나 윈도우를 닫으면*== 서버가 보냈던 쿠키는 모두 만료되어 브라우저는 더 이상 해당 쿠키를 서버에 돌려 보내지 않음

#### 영속 쿠키
##### 📩 HTTP 응답
```js
Set-Cookie: <쿠키 이름>=<쿠키 값>; Expires=종료 시점
Set-Cookie: <쿠키 이름>=<쿠키 값>; Max-Age=유효 기간
```

- `Max-Age` : 초 단위로 설정
- `Max-Age`, `Expires` 둘 다 있을 경우 `Max-Age` 우선
- 브라우저에 저장해두었던 쿠키를 즉시 만료하고 싶을 때는 `Max-Age` 속성을 0으로 설정

##### 📩 HTTP 응답
```js
Set-Cookie: a=1; Max-Age=0
```

-----------------------
## 쿠키의 적용 범위

##### 📩 HTTP 응답
```js
Set-Cookie: <쿠키 이름>=<쿠키 값>; Domain=도메인
```
- `Set-Cookie` 응답 헤더에 `Domain`속성을 명시하면, 서브 도메인까지 포함되도록 쿠키의 범위가 확장
- -> 두 도메인이 쿠키를 공유하는 효과

##### 📩 HTTP 응답
```js
Set-Cookie: <쿠키 이름>=<쿠키 값>; Path=경로
```
- 반대로 `Path` 를 통해 범위를 축소시킬 수도 있음


--------------------------
## 쿠키의 한계

1. 쿠키는 유실되기 쉽다
	- 브라우저에서 쉽게 쿠키를 삭제할 수 있음
	- 브라우저가 하드디스크의 어느 경로에 저장하는지 구글링만 해보면 알 수 있기에 폴더를 삭제해버릴 수도 있음

2. 쿠키는 변조되기 쉽다
	- 브라우저의 개발자 도구를 사용해 어떤 쿠키가 저장되어 있는지 파악하기 쉽고 손쉽게 변경도 가능
	- 쿠키를 변조해 서버로 보내는 것도 충분히 가능한 일

3. 쿠키는 도난되기 쉽다
	- 클라이언트에 저장되어 있는 쿠키를 탈취하는 것을 서버는 막을 수 없음
	- 개인 정보와 같이 민감한 데이터는 쿠키로 사용 금지!


------------------------------
## 쿠키의 보안 속성

#### Secure
```js
Set-Cookie: <쿠키 이름>=<쿠키 값>; Secure
```
- 브라우저가 `https` 프로토콜 상에서만 서버로 돌려 보냄

#### HttpOnly
```js
Set-Cookie: <쿠키 이름>=<쿠키 값>; HttpOnly
```
- 브라우저에서 자바스크립트로 `Document.cookie` 객체를 통해 접근할 수 없음
- 서드 파티 자바스크립트 코드가 쿠키에 접근하는 것을 제한